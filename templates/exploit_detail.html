{% extends 'base.html' %}

{% block title %}Scan Page{% endblock %}

{% block content %}
    <div class="container">
        <h1 class="title">Exploit: {{ exploit.name }}</h1>
        <p class="description">요약: {{ exploit.description }}</p>
        <p class="category">분류: {{ exploit.category }}</p>
        <p class="script-name">스크립트 이름: {{ exploit.script }}</p>

        <div class="execution-section">
            <h2>공격 실행</h2>
            <form id="exploitForm" method="POST" action="{% url 'exploit_detail' name=exploit.name %}">
                {% csrf_token %}
                <div class="input-group">
                    <label for="ip_address">IP 주소:</label>
                    <input type="text" id="ip_address" name="ip_address" value="{{ ip_address }}" required>
                </div>
                <div class="input-group">
                    <label for="username">사용자명 (선택사항):</label>
                    <input type="text" id="username" name="username" placeholder="사용자명">
                </div>
                <button type="submit" class="btn-execute">익스플로잇 실행</button>
            </form>
        </div>

        <div class="result-section">
            <h2>결과</h2>
            <div id="output-container" class="result-box">
                <pre id="output">No output</pre>
                <pre id="error">No errors</pre>
            </div>
        </div>

        <div id="loading-message" class="loading hidden">코드 실행 중...</div>
    </div>

    <script>
        document.getElementById("exploitForm").onsubmit = async function(event) {
            event.preventDefault();
            
            document.getElementById("loading-message").classList.remove("hidden");

            const formData = new FormData(this);
            const response = await fetch("{% url 'exploit_detail' name=exploit.name %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: formData
            });

            document.getElementById("loading-message").classList.add("hidden");

            if (response.ok) {
                const data = await response.json();
                document.getElementById("output").textContent = data.stdout || "No output";
                document.getElementById("error").textContent = data.stderr || "No errors";
            } else {
                document.getElementById("output").textContent = "Failed to execute exploit.";
                document.getElementById("error").textContent = response.statusText;
            }
        };
    </script>
<style>
    .container {
        max-width: 95%;
        margin: 40px auto;
        padding: 20px;
    }

    .title {
        font-size: 2rem;
        color: #000;
        margin-bottom: 50px;
    }

    .description, .category, .script-name {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }

    .execution-section, .result-section {
        margin: 30px 0;
    }

    .input-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }

    input[type="text"] {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .btn-execute {
        background-color: black;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    .btn-execute:hover {
        background-color: #333;
    }

    .result-box {
        background-color: black;
        color: #a8ff60;
        padding: 20px;
        border-radius: 8px;
        font-size: 1rem;
        max-height: 300px;
        overflow-y: auto;
    }

    .loading {
        text-align: center;
        color: #1ea7fd;
        font-size: 1.5rem;
        margin: 20px 0;
    }

    .hidden {
        display: none;
    }
</style>
{% endblock %}

